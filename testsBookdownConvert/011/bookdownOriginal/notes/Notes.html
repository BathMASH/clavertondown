<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Test 011: A fenced div environment in the new format used by bookdown" />
<meta property="og:type" content="book" />





<meta name="author" content="Emma Cliffe, Skills Centre: MASH, University of Bath" />


<script type="text/x-mathjax-config">
MathJax.Hub.Register.MessageHook("End Math", function (msg) {
  var nodes = Array.from(msg[1].querySelectorAll('.MJX_Assistive_MathML [id]'));
  while (nodes.length) {
    nodes.shift().removeAttribute('id');
  }
}, 20);
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  "fast-preview": {disabled: true},
  explorer:{ subtitle: true },
  MatchWebFonts: { 
    matchFor: { "HTML-CSS": true, NativeMML: false, SVG: false },
    fontCheckDelay: 2000,
    fontCheckTimeout: 30 * 1000
  },
  "HTML-CSS": {
    preferredFont: "STIX",
    availableFonts: ["STIX","TeX"],
    webFont: "STIX-Web",
    linebreaks: { automatic: true, width: "90\% container" }
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90\% container" }
  },
  SVG: {
    font: "STIX-Web",
    linebreaks: { automatic: false, width: "90\% container" }
  },
  menuSettings: { 
    collapsible: false, 
    autocollapse: false, 
    explorer: false 
  }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Test 011: A fenced div environment in the new format used by bookdown">

<title>Test 011: A fenced div environment in the new format used by bookdown</title>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>

<style type="text/css">
  a {
   color: blue;
  }

  [custom-style=DefinitionStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: AliceBlue;
    border-left-style: solid;
    border-color: CadetBlue;
    padding-left: 0.5em;
  }

  [custom-style=TheoremStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: honeydew;
    border-left-style: solid;
    border-color: darkseagreen;
    padding-left: 0.5em;
  }

  [custom-style=ProofStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: seashell;
    border-left-style: solid;
    border-color: darkkhaki;
    padding-left: 0.5em;
  }

  [custom-style=ExampleStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: lavenderblush;
    border-left-style: solid;
    border-color: mediumorchid;
    padding-left: 0.5em;
  }

  [data-custom-style=DefinitionStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: AliceBlue;
    border-left-style: solid;
    border-color: CadetBlue;
    padding-left: 0.5em;
  }

  [data-custom-style=TheoremStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: honeydew;
    border-left-style: solid;
    border-color: darkseagreen;
    padding-left: 0.5em;
  }

  [data-custom-style=ProofStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: seashell;
    border-left-style: solid;
    border-color: darkkhaki;
    padding-left: 0.5em;
  }

  [data-custom-style=ExampleStyle] {
    margin-bottom: 1.5em;
    margin-top:1.5em;
    background-color: lavenderblush;
    border-left-style: solid;
    border-color: mediumorchid;
    padding-left: 0.5em;
  }

  
</style>

</head>

<body>

<div class="container-fluid main-container">


<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Test 011: A fenced div environment in the new format used by bookdown</h1>
<h4 class="author"><em>Emma Cliffe, Skills Centre: MASH, University of Bath</em></h4>
<h4 class="date"><em>August 2020</em></h4>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<!--bookdown:toc:end-->

<!--bookdown:body:start-->
<div id="blah" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Blah</h1>
<p>We should be able to intersect a fenced div WHEN:</p>
<ul>
<li>It corresponds to an internal and static list of Bookdown theorem types OR</li>
<li>It has been declared by a clavertondown user in the _bookdown.yml file as a newtheorem type</li>
</ul>
<p>NO other fenced divs should be disturbed.</p>
<p>Further, this should continue to function as expected in ALL clavertondown formats and not just HTML and PDF as in Bookdown.</p>
</div>
<div id="what-needs-to-happen" class="section level1" number="2">
<h1><span class="header-section-number">2</span> What needs to happen</h1>
<p>Fenced div:</p>
<div id="pyth1" class="theorem" name="Pythagorean theorem">
<p>For a right triangle, if <span class="math inline">\(c\)</span> denotes the length of the hypotenuse
and <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> denote the lengths of the other two sides, we have</p>
<p><span class="math display">\[a^2 + b^2 = c^2\]</span></p>
</div>
<p>should result in exactly the same output as</p>

<div id="thm:pyth2" class="bookdown-theorem" custom-style="TheoremStyle">
<span class="thm:pyth2" custom-style="NameStyle"><strong>Theorem 2.1:  (Pythagorean theorem)  </strong></span>
<div style="font-style:italic">
<p>For a right triangle, if <span class="math inline">\(c\)</span> denotes the length of the hypotenuse
and <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> denote the lengths of the other two sides, we have</p>
<span class="math display">\[a^2 + b^2 = c^2\]</span>
</div>
</div>
<p>but other fenced divs INCLUDING those which use user defined clavertondown environments SHOULD NOT convert. We are not opening this up as a format due to the fundamental differences.</p>
<p>Hence the below will NOT convert</p>
<div id="def1" class="Nugget">
<p>For a right triangle, if <span class="math inline">\(c\)</span> denotes the length of the hypotenuse
and <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> denote the lengths of the other two sides, we have</p>
<p><span class="math display">\[a^2 + b^2 = c^2\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">+</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<p>but should have been encoded as</p>

<div id="nug:def1" class="Nugget" custom-style="TheoremStyle">
<span class="Nugget" custom-style="NameStyle"><strong> Nugget 2.2:  </strong></span>
<div style="font-style:italic">
<p>For a right triangle, if <span class="math inline">\(c\)</span> denotes the length of the hypotenuse
and <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> denote the lengths of the other two sides, we have</p>
<span class="math display">\[a^2 + b^2 = c^2\]</span>
</div>
</div>
<p>but that would not be backwards compatibility at this point. That would be new functionality.</p>
<p>The following should not convert:
:::: {.theorem #pyth1 name=“Pythagorean theorem”}
For a right triangle, if <span class="math inline">\(c\)</span> denotes the length of the hypotenuse
and <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> denote the lengths of the other two sides, we have</p>
<p><span class="math display">\[a^2 + b^2 = c^2\]</span>
::::</p>
<p>There is an added problem. It is feasible, but I haven’t tested it, that an engine based code environment can be embedded in a fenced div environment in the new bookdown approach. For backwards compatibility we need to honour this if needed. It isn’t possible in the engine based method to put an engine environment inside another so this functionality cannot be added to standard clavertondown environments - as they are intersepted by knitr rather than Pandoc. It is therefore feasible that this new syntax may become the favoured syntax within clavertondown. So, we have to be really careful here.</p>
<p>We also need to keep all the things we have added working to - which DO NOT work in Bookdown in the new fenced div approach.</p>
</div>
<div id="how-to-achieve-this" class="section level1" number="3">
<h1><span class="header-section-number">3</span> How to achieve this?</h1>
<p>Fenced divs in Pandoc are HTML transformable but not LaTeX/PDF transformable. But, in Pandoc these specific fenced divs ARE transformable to LaTeX (but, I assume, not others). This means that we should look at the latex.R code in the new Bookdown as they must be intercepting at this point.</p>
<p>This does lead to the obvious question: Why only LaTeX/PDF, why not also make it work in EPub and Word? Is there something fundamental I have missed that means these can’t be intercepted in this case?</p>
<ul>
<li>EPub is basically HTML, maybe it works more or less but they haven’t tested it/fixed some small things. Try to not intercept it.</li>
<li>Word is a different matter.</li>
</ul>
</div>
<div id="things-to-note-immediately" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Things to note immediately</h1>
<p>Out the box we have the text and in the right style but we have lost everything else. The latter is unsurprising but the former is odd.</p>
<p>Actually, this is true only in HTML so this is less odd.</p>
</div>
<div id="this-is-a-custom-lua-filter" class="section level1" number="5">
<h1><span class="header-section-number">5</span> This is a custom Lua filter</h1>
<p>Okay, so what happens is there is a new function called common_format_config. This does a few things but the one we care about right now is that it passes ALL control of what happens in LaTeX AND HTML to a custom Lua script for Pandoc.</p>
<p>This is not great. It replicates the same hard-encoding that we see in Bookdown but now we are outside of a situation where we can realistically do anything about it. They have definitely gone further down the hard-encoding route - and further away from being able to do any of the things that our user base wants e.g. with respect to numbering. There is nothing which isn’t a terrible hackfest if we go in the Lua direction.
It is here that the begins turn up for the LaTeX and there is hard-encoded assumptions about the LaTeX you can get out.</p>
<p>So, we aren’t going to do that. That means that we need to intercept and change what is happening BEFORE we get to Pandoc. What are the options?</p>
<p>We need to define a preprocessor… There are examples of this in word and ebook formats already. Basically, as a ‘simple’ first fix we are just going to rewrite the markdown. So, we should be able to intercept at this point?</p>
<p>Yes, we can. It rewrites from Rmd to md. BUT, we can’t just replace : with ` etc. This is ‘too late’ already. Instead we have to … do what the engine does? Is there really no way to rewrite and then re-trigger the engines?</p>
</div>
<div id="testing-all-the-hard-encoded-bookdown-envs" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Testing all the hard encoded bookdown envs</h1>
<div class="theorem">
<p>Theorem</p>
</div>
<div class="lemma">
<p>Lemma</p>
</div>
<div class="corollary">
<p>Corollary</p>
</div>
<div class="proposition">
<p>Proposition</p>
</div>
<div class="conjecture">
<p>Conjecture</p>
</div>
<div class="definition">
<p>Definition</p>
</div>
<div class="example">
<p>Example</p>
</div>
<div class="exercise">
<p>Exercise</p>
</div>
<div class="hypothesis">
<p>Hypothesis</p>
</div>
<div class="proof">
<p>Proof</p>
</div>
<div class="solution">
<p>Solution</p>
</div>
<div class="remark">
<p>Remark</p>
</div>
<p>And this shouldn’t work:</p>
<div class="remark">
<p>Thing that shouldn’t convert</p>
</div>
<!--chapter:end:index.Rmd-->
</div>
<!--bookdown:body:end-->


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
